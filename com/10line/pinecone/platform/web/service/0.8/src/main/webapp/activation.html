<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
		
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="css/style.css">
		
		<style type="text/css" media="screen">
			html,
			body {
			  height: 100%;
			  /* The html and body elements cannot have any padding or margin. */
			}

			/* Wrapper for page content to push down footer */
			#wrap {
			  min-height: 100%;
			  height: auto !important;
			  height: 100%;
			  /* Negative indent footer by its height */
			  margin: 0 auto -60px;
			  /* Pad bottom by footer height */
			  padding: 0 0 60px;
			}

			/* Set the fixed height of the footer here */
			#footer {
			  height: 60px;
			  background-color: #f5f5f5;
			}


			/* Custom page CSS
			-------------------------------------------------- */
			/* Not required for template or sticky footer method. */
			.container .credit {
			  margin: 20px 0;
			}
		</style>
		
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
        <!-- Add your site or application content here -->
		<!-- Wrap all page content here -->
		<div id="wrap">

			<!-- Fixed navbar -->
			<div class="navbar navbar-inverse navbar-fixed-top">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">
							<img src="img/logo.png" />
						</a>
					</div>
					<div class="navbar-collapse collapse pull-right" style="padding-top: 7px;">
						<ul class="nav navbar-nav">
							<div class="btn-group pull-right" style="padding-top: 10px;">
								<a href="j_spring_security_logout" class="btn btn-info">注销</a>
								<a href="console.html" class="btn btn-info">返回控制台</a>
							</div>
						</ul>
					</div>
				</div>
			</div>

			<!-- Begin page content -->
			<div class="container" style="padding-top:100px;">
					<div class="row">
						<div class="col-sm-2 col-md-3 col-lg-3 hidden-sm">
						</div>
						<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
							<div class="row">
								<div class="col-sm-2 col-md-2 col-lg-2 hidden-sm"></div>
								<div class="well col-xs-12 col-sm-12 col-md-8 col-lg-8">
									<form id="activation" role="form" method="post" action="#">
										<legend>激活设备！</legend>
										<div class="form-group">
											<label for="devicecode" class="control-label">设备编码</label>
											<input type="text" class="form-control" id="devicecode" name="devicecode" placeholder="设备编码">
										</div>
										<div class="form-group">
											<label for="devicename" class="control-label">设备名称</label>
											<input type="text" class="form-control" id="devicename" name="devicename" placeholder="设备名称">
										</div>
										<div class="form-group pull-right">
											<div class="col-sm-12 pull-right">
												<button type="submit" class="btn btn-success">激活</button>
												<button type="reset" class="btn btn-default">重置</button>
											</div>
										</div>
									</form>
								</div>
								<div class="col-sm-2 col-md-2 col-lg-2 hidden-sm"></div>
							</div>
						</div>
						<div class="col-sm-2 col-md-3 col-lg-3 hidden-sm">
						</div>
					</div>
			</div>
		</div>

		<div id="footer">
			<div class="container">
				<p class="text-muted credit">&copy; 2013 北京松果科技有限公司&nbsp;<a href="http://www.miitbeian.gov.cn/" target="_blank">京ICP备13022507号</a></p>
			</div>
		</div>
		
        <script src="js/vendor/jquery-1.9.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.9.0.min.js"><\/script>')</script>
		<!-- Latest compiled and minified JavaScript --> 
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.validate.min.js"></script>
		<script src="js/additional-methods.min.js"></script>
		<script src="js/localization/messages_zh.js"></script>
		<script src="js/jquery.html5storage.min.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
		<script type="text/javascript">
		$(document).ready(function() {
		
			$("#activation").validate({
				rules : {
					devicecode : {
						required : true,
						remote : {
							url : "/rest/m/device/search/activation/codes",
							username : $.sessionStorage.getItem("username"),
				    		password : $.sessionStorage.getItem("password")
						}
					},
					devicename : {
						required : true
					}
				},
				submitHandler : function() {
					getDeviceId($("#devicecode").val());
		        }
			});
		
		});
		
		function getDeviceId(code) {
    		$.ajax({
		    	type : "GET",
		    	url : "/rest/device/search/codes?code=" + code,
		    	dataType : "json",
		    	username : $.sessionStorage.getItem("username"),
		    	password : $.sessionStorage.getItem("password"),
		    	success : function(data) {
		    		var href = data.results[0]._links[2].href;
		    		activateDevice(href.substring(href.lastIndexOf("/") + 1));
		    	}
			});
    	}
		
		function activateDevice(id) {
			$.ajax({
		    	type : "POST",
		    	username : $.sessionStorage.getItem("username"),
	    		password : $.sessionStorage.getItem("password"),
		    	url : "/rest/device/" + id + "/user",
		    	contentType : "text/uri-list; charset=utf-8",
		    	data : "http://" + location.host + "/rest/user/" + $.sessionStorage.getItem("userId"),
		    	success : function() {
		    		window.location = "console.html";
		    	}
			});
		}
		
		</script>
    </body>
</html>
